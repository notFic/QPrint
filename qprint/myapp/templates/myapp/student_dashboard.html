{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Q-Print Student Dashboard</title>
  <link rel="stylesheet" href="{% static 'qprint/css/student_dashboard.css' %}">
</head>
<body>

  <div class="header-bar" role="banner">
    <img src="{% static 'qprint/images/header.jpg' %}" alt="" aria-hidden="true" class="header-background">
    <button class="menu-btn" aria-label="Toggle sidebar" aria-controls="sidebar">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
      </svg>
    </button>
    <img src="{% static 'qprint/images/logo.png' %}" alt="QPrint Logo" class="header-logo">
    <div class="header-title">Q-Print</div>
  </div>

  <div class="sidebar" id="sidebar" role="complementary" aria-label="Sidebar navigation">
    <div class="sidebar-header">
      <h2>Menu</h2>
      <button class="close-btn" aria-label="Close sidebar">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
      </button>
    </div>
    <div class="sidebar-content">
      <a href="#profile">Profile</a>
      <a href="#settings">Settings</a>
      <a href="#support">Contact Support</a>
      <a href="#terms">Terms of Service</a>
      <button type="button" class="logout-link" id="logout-btn">Log Out</button>
    </div>
  </div>

  <div class="backdrop" id="backdrop" aria-hidden="true"></div>

  <div class="logout-modal" id="logout-modal">
    <div class="modal-box">
      <h2>Confirm Log Out</h2>
      <p>Are you sure you want to log out?</p>
      <div class="modal-actions">
        <button type="button" class="modal-btn cancel-btn" id="cancel-logout-btn">Cancel</button>
        <a href="{% url 'logout' %}" class="modal-btn confirm-btn">Yes, Log Out</a>
      </div>
    </div>
  </div>

  <div class="container" role="main">
    <h1>Welcome, Student {{ request.user.username|capfirst }}</h1>
    <div class="content-grid">
        <div class="left-col">
            <div class="card">
              <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <h2>File Submission</h2>
                <p>Upload your document and specify print details.</p>

                {% if messages %}
                  <div class="messages">
                    {% for message in messages %}
                      <p class="error-message">{{ message }}</p>
                    {% endfor %}
                  </div>
                {% endif %}

                <div class="file-upload">
                  <label for="fileInput">Choose PDF</label>
                  <input type="file" id="fileInput" name="print_file" accept=".pdf" onchange="this.form.submit()">
                </div>

                {% if file_name %}
                  <div class="filename-display">
                    <p><strong>Selected File:</strong></p>
                    <span>{{ file_name }}</span>
                  </div>
                {% endif %}

                <div class="print-options">
                  <div class="form-group">
                    <label for="pages">Number of Pages</label>
                    <input type="number" id="pages" name="pages" placeholder="e.g., 10" value="{{ form_data.pages }}">
                  </div>
                  <div class="form-group">
                    <label for="paper_size">Paper Size</label>
                    <select id="paper_size" name="paper_size">
                      <option value="" {% if not form_data.paper_size %}selected{% endif %} disabled>Select a size</option>
                      <option value="A4" {% if form_data.paper_size == 'A4' %}selected{% endif %}>A4 (8.27" x 11.69")</option>
                      <option value="Letter" {% if form_data.paper_size == 'Letter' %}selected{% endif %}>Letter (8.5" x 11")</option>
                      <option value="Long" {% if form_data.paper_size == 'Long' %}selected{% endif %}>Long (8.5" x 13")</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="color_option">Color Option</label>
                    <select id="color_option" name="color_option">
                      <option value="" {% if not form_data.color_option %}selected{% endif %} disabled>Select a color</option>
                      <option value="bw" {% if form_data.color_option == 'bw' %}selected{% endif %}>Black & White</option>
                      <option value="color" {% if form_data.color_option == 'color' %}selected{% endif %}>Color</option>
                    </select>
                  </div>
                </div>

                <button type="submit" name="action" value="calculate" class="secondary-btn">Calculate Cost</button>

                {% if total_cost %}
                  <div class="total-cost-display">
                    <h3>Total Estimated Cost:</h3>
                    <span>â‚±{{ total_cost }}</span>
                  </div>
                {% endif %}

                <button type="submit" name="action" value="submit_job" class="primary-btn">Submit Print Job</button>
              </form>
            </div>
          </div>

          <div class="right-col">
            <div class="card">
              <h2>File Preview</h2>
              <div class="preview-box">
                {% if pdf_data %}
                  <iframe class="pdf-iframe" src="data:application/pdf;base64,{{ pdf_data }}" title="PDF Preview"></iframe>
                {% else %}
                  <div class="preview-placeholder"><p>Upload a PDF to see the preview here</p></div>
                {% endif %}
              </div>
            </div>
          </div>
    </div>
  </div>

  <script>
    // Sidebar toggle
    (function(){
      const menuBtn = document.querySelector('.menu-btn');
      const sidebar = document.querySelector('.sidebar');
      const closeBtn = document.querySelector('.close-btn');
      const backdrop = document.querySelector('.backdrop');
      function toggleSidebar() {
        sidebar.classList.toggle('open');
        backdrop.classList.toggle('active');
      }
      menuBtn.addEventListener('click', toggleSidebar);
      closeBtn.addEventListener('click', toggleSidebar);
      backdrop.addEventListener('click', toggleSidebar);
    })();

    (function(){
      const logoutBtn = document.getElementById('logout-btn');
      const logoutModal = document.getElementById('logout-modal');
      const cancelBtn = document.getElementById('cancel-logout-btn');

      if (logoutBtn && logoutModal && cancelBtn) {
        // Show the modal when the logout button is clicked
        logoutBtn.addEventListener('click', function() {
          logoutModal.classList.add('is-visible');
        });

        // Hide the modal when the cancel button is clicked
        cancelBtn.addEventListener('click', function() {
          logoutModal.classList.remove('is-visible');
        });

        // Hide the modal when clicking on the background overlay
        logoutModal.addEventListener('click', function(event) {
          if (event.target === logoutModal) {
            logoutModal.classList.remove('is-visible');
          }
        });
      }
    })();
  </script>
</body>
</html>